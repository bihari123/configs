#!/bin/bash
# Browse pane logs - show menu of saved pane logs

PANE_LOGS_DIR="$HOME/.tmux/pane-logs/latest"

if [ ! -d "$PANE_LOGS_DIR" ]; then
    echo "âŒ No pane logs found."
    echo ""
    echo "Pane logs are saved automatically when you save sessions."
    echo "Save now with: Alt+Shift+s"
    exit 1
fi

# Build list of log files with session/window/pane info
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘              SAVED PANE LOGS (Last 500 Lines)              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# List all sessions
for session_dir in "$PANE_LOGS_DIR"/*; do
    if [ ! -d "$session_dir" ]; then
        continue
    fi

    SESSION=$(basename "$session_dir")
    echo "  ğŸ“ Session: $SESSION"
    echo ""

    # List all log files in this session
    find "$session_dir" -type f -name "*.log" | sort | while read -r log_file; do
        # Get window and pane from filename
        FILENAME=$(basename "$log_file" .log)
        WINDOW=$(echo "$FILENAME" | sed 's/window-\([0-9]*\)_pane-\([0-9]*\)/\1/')
        PANE=$(echo "$FILENAME" | sed 's/window-\([0-9]*\)_pane-\([0-9]*\)/\2/')

        # Get file size and line count
        SIZE=$(du -h "$log_file" | cut -f1)
        LINES=$(wc -l < "$log_file")

        echo "     ğŸ“„ Window $WINDOW, Pane $PANE"
        echo "        â”œâ”€ File: $(basename "$log_file")"
        echo "        â”œâ”€ Size: $SIZE ($LINES lines)"
        echo "        â””â”€ cat $log_file"
        echo ""
    done
done

echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo "ğŸ“‚ Location: $PANE_LOGS_DIR"
echo ""
echo "Commands:"
echo "  â€¢ View specific pane:"
echo "    cat $PANE_LOGS_DIR/SESSION/window-X_pane-Y.log"
echo ""
echo "  â€¢ Browse all logs:"
echo "    ls -lh $PANE_LOGS_DIR/"
echo ""
echo "  â€¢ Search in logs:"
echo "    grep -r 'search term' $PANE_LOGS_DIR/"
